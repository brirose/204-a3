---
title: "ESM 204 HW 3: Distributional consequences of climate policy"
author: "Bri Baker and Anna Talken"
date: "Spring 2021"
output:
  html_document:
    theme: cosmo
    highlight: kate
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, 
                      message = FALSE,
                      warning = FALSE)
library(tidyverse)
library(here)
library(janitor)
```

## Data Setup
```{r}
gas <- read_csv(here("HW3_data.csv")) %>% 
  clean_names() %>% 
  mutate(q_agg_gal = q_low_gallons + q_high_gallons)

gas_price <- 3 # $/gal
scc <- 51 # $/metric ton
ton <- 2000 # lb

```

## Question 1
```{r}
emission_gal <- 19.6 # tons of co2 in a gallon of gas

mec <- emission_gal*(1/ton)*scc

```

The marginal external cost is $`r round(mec, 3)`/gal.


## Question 2
```{r demand curve}
d_agg <- lm(price_dollars ~ q_agg_gal, data = gas)

d_agg_slope <- d_agg$coefficients[[2]]
d_agg_intercept <- d_agg$coefficients[[1]]

demand <- function(q, model){
  p <- model$coefficients[[1]] + model$coefficients[[2]]*q
return(p)
}

inverse_demand <- function(p, model){
  q <- (p - model$coefficients[[1]])/model$coefficients[[2]]
  return(q)
}

```

Aggregate demand: p = `r round(d_agg_slope, 2)`q + `r round(d_agg_intercept)`

```{r supply curve}

s_slope <- (0-inverse_demand(3, d_agg))/(0-3)

s_intercept <- 0


```

Aggregate supply: p = `r round(s_slope, 2)`q + `r round(s_intercept)`

```{r surplus}

surplus_p <- function(p, model){
  q <- inverse_demand(p, model)
  cs <- 0.5*(model$coefficients[[1]] - p)*q
  return(cs)
}

surplus_q <- function(q, model){
  p <- demand(q, model)
  cs <- 0.5*(model$coefficients[[1]] - p)*q
  return(cs)
}

cs_initial <- surplus_p(3, d_agg)

ps_initial <- 0.5*(3*inverse_demand(3, d_agg))

```


