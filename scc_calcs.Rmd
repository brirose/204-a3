---
title: "ESM 204 HW 3: Distributional consequences of climate policy"
author: "Bri Baker and Anna Talken"
date: "Spring 2021"
output:
  html_document:
    theme: cosmo
    highlight: kate
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, 
                      message = FALSE,
                      warning = FALSE)
library(tidyverse)
library(here)
library(janitor)

options(scipen=999)
```

## Data Setup
```{r data info}
gas <- read_csv(here("HW3_data.csv")) %>% 
  clean_names() %>% 
  mutate(q_agg_gal = q_low_gallons + q_high_gallons)

gas_price <- 3 # $/gal
scc_ton <- 51 # $/metric ton
ton <- 2000 # lb
scc_lb <- scc_ton/ton

```


## Question 1
```{r}
emission_gal <- 19.6 # pounds of co2 in a gallon of gas

mec <- emission_gal*scc_lb

```

The marginal external cost is $`r mec`/gal.


## Question 2

```{r demand curve}
d_agg <- lm(price_dollars ~ q_agg_gal, data = gas) #create linear model

d_agg_slope <- d_agg$coefficients[[2]] #finds the slope
d_agg_intercept <- d_agg$coefficients[[1]] #finds the intercept

demand <- function(q, model){
  p <- model$coefficients[[1]] + model$coefficients[[2]]*q
return(p)
}

inverse_demand <- function(p, model){
  q <- (p - model$coefficients[[1]])/model$coefficients[[2]]
  return(q)
}

```

Aggregate demand: p = `r d_agg_slope`q + `r d_agg_intercept`

```{r supply curve}
s_slope <- (3/inverse_demand(3,d_agg))

s_intercept <- 0
```

```{r}
random_x <- data_frame("random" = 0:900000)
```

```{r}
# Plotting demand and supply curves

#DEMAND CURVE
d_ag <- lm(price_dollars ~ q_agg_gal, data = gas) #create linear model

d_ag_slope <- d_ag$coefficients[[2]] #finds the slope
d_ag_intercept <- d_ag$coefficients[[1]] #finds the intercept

price_fitted_demand <- d_ag_intercept + d_ag_slope*gas$q_agg_gal #creates estimated line for demand

price_fitted_supply <- s_intercept + s_slope*gas$q_agg_gal #creates estimated line for supply

#aggregate_demand <- ggplot(data=gas, aes(x=q_agg_gal,y=price_dollars))+
  #geom_point() +
  #theme_minimal()+
  #labs(x = "Quantity of gas demanded (gal)",
      # y = "Price ($/gal)",
      # title = "Aggregate demand for gasoline using linear regression") +
  #geom_line(aes(y=price_fitted_demand, x=random_x$random)) +
 # geom_line(aes(y=price_fitted_supply, x=random_x$random)) #plotted the fitted relationship on the graph

#aggregate_demand

```

Supply: p = `r s_slope`q

```{r surplus}

surplus_p <- function(p, model){
  q <- inverse_demand(p, model)
  cs <- 0.5*(model$coefficients[[1]] - p)*q
  return(cs)
}

surplus_q <- function(q, model){
  p <- demand(q, model)
  cs <- 0.5*(model$coefficients[[1]] - p)*q
  return(cs)
}

cs_initial <- surplus_p(3, d_agg)

ps_initial <- 0.5*(3*inverse_demand(3, d_agg))

```

Consumer benefit: $`r cs_initial`

Producer benefit: $`r ps_initial`

```{r env cost initial}
env_costs <- inverse_demand(3, d_agg)*mec
```

Environmental cost: $`r env_costs`


## Question 3

```{r demands}

d_low <- lm(price_dollars ~ q_low_gallons, data = gas) # create linear model for low
d_high <- lm(price_dollars ~ q_high_gallons, data = gas) # create linear model for high

cs_low_initial <- surplus_p(3, d_low)

cs_high_initial <- surplus_p(3, d_high)

```

High income consumer benefit: $`r cs_high_initial`

Low income consumer benefit: $`r cs_low_initial`


## Question 4

```{r tax}

tax <- mec # since mec curve is constant, optimal tax = mec

```

The optimal tax is $`r tax`.

(a) The amount of gasoline produced and consumed: 568719.051 gal
(b) The price of gasoline: $3.40

(c) Overall welfare of "high" income consumers: 
```{r}
cs_high_tax <- surplus_p(3.4, d_high)

high_loss_tax <- cs_high_initial-cs_high_tax

```
$`r high_loss_tax`


(d) Overall welfare of "low" income consumers:
```{r}
env_cost_tax <- mec*568719.051

cs_low_tax <- surplus_p(3.4, d_low)-env_cost_tax

low_loss_tax <- cs_low_initial-cs_low_tax

```
$`r cs_low_tax`


(e) Gas producers:
```{r}

ps_tax <- 0.5*(3.4-tax)*568719.051
ps_loss_tax <- ps_initial-ps_tax

```
Net loss: $`r ps_loss_tax`

(f) Total environmental damage: $`r round(env_cost_tax, 2)`
(g) Total tax revenue generated: $`r round(env_cost_tax, 2)`


